# C++类的六大函数

### 总览

- 拷贝构造 和 移动构造 都是用已有对象 构造新的对象；
  - 如果已有对象**仍需引用或利用**，需要自定义**拷贝**构造函数（深拷贝）；
  - 如果已有对象**无需引用或利用**，需要自定义**移动**构造函数（浅拷贝）；
- 拷贝赋值 和 移动赋值 都是将已有对象赋值另一个已有对象；
  - 如果已有对象**仍需引用或利用**，需要自定义**拷贝**赋值函数（深拷贝）；
  - 如果已有对象**无需引用或利用**，需要自定义**移动**赋值函数（浅拷贝）

```c++
class T{
    T();                	//默认的构造函数
    T(SomeType);        	//普通的构造函数
    T(const T&);        	//拷贝构造函数
    T(T&&);             	//移动构造函数
    T& operator=(const T&); //拷贝赋值函数
    T& operator=(T&&);      //移动赋值函数
    ~T();                   //析构函数
}
```

一个空类，编译器默认添加以下函数：

- 默认构造函数和拷贝构造函数
- 析构函数
- 赋值函数（赋值运算符）
- 取值函数

### 构造

***\*构造函数可以被重载，可以多个，可以带参数；\****

### 析构

**析构函数只有一个，不能被重载，不带参数**

### 拷贝构造

#### 前提知识点

1. 深拷贝与浅拷贝

#### 基本概念

用一个**已有**对象去**初始化**一个**新的**对象。

**默认**拷贝构造函数工作方式**浅拷贝**，当对象中用到了需要手动释放的对象，则会出现问题，需要重载拷贝构造函数，实现深拷贝。

### 移动构造



### 拷贝赋值



### 移动赋值



### 举例验证

```c++
#include <iostream>
using namespace std;

class A {
public:
    int x;
    A(int x) : x(x){
        cout << "Constructor" << endl;
    }
    A(A& a) : x(a.x){
        cout << "Copy Constructor" << endl;
    }
    A& operator=(A& a){
        x = a.x;
        cout << "Copy Assignment operator" << endl;
        return *this;
    }
    A(A&& a) : x(a.x){
        cout << "Move Constructor" << endl;
    }
    A& operator=(A&& a){
        x = a.x;
        cout << "Move Assignment operator" << endl;
        return *this;
    }
};
A GetA(){
    return A(1);
}
A&& MoveA(A& a){
    return std::move(a);
}
int main(){
    A a(1);     //构造函数，无需解释
    A b = a;    //拷贝构造，用已有创建新的
    A c(a);     //拷贝构造，用已有创建新的
    b = a;      //拷贝赋值，用已有的a给b更新值
    A d = A(1); //移动构造，用A(1)初始化d，临时对象A(1)是右值，故移动构造初始化d
    A e = std::move(a); //移动构造,左值 a 转为了右值
    A f = GetA();       //构造A(1),再移动构造一个临时对象，用临时对象移动构造f
    A&& g = MoveA(f);   //不创建对象，也不更新对象，只是将MoveA()返回值绑定到右值引用g
    d = A(1);           //移动赋值
}
```

参考链接的输出：

```c++
-------------------------1-------------------------
Constructor
-------------------------2-------------------------
Copy Constructor
-------------------------3-------------------------
Copy Constructor
-------------------------4-------------------------
Copy Assignment operator
-------------------------5-------------------------
Constructor
Move Constructor
-------------------------6-------------------------
Move Constructor
-------------------------7-------------------------
Constructor
Move Constructor
Move Constructor
-------------------------8-------------------------
-------------------------9-------------------------
Constructor
Move Assignment operator
```

实际运行的输出：

```
-------------------------1-------------------------
Constructor
-------------------------2-------------------------
Copy Constructor
-------------------------3-------------------------
Copy Constructor
-------------------------4-------------------------
Copy Assignment operator
-------------------------5-------------------------
Constructor
-------------------------6-------------------------
Move Constructor
-------------------------7-------------------------
Constructor
-------------------------8-------------------------
-------------------------9-------------------------
Constructor
Move Assignment operator
```



### 参考链接

1. [C++类的六大函数--构造、析构、拷贝构造、移动构造、拷贝赋值、移动赋值](https://www.cnblogs.com/lincz/p/10768607.html)
2. [C++构造、析构、拷贝构造、拷贝赋值、移动构造、移动赋值（一） (fengyuanblog.github.io)](https://fengyuanblog.github.io/2017/06/20/C++构造-析构-拷贝构造-拷贝赋值-移动构造-移动赋值-一/)
3. [C++构造、析构、拷贝构造、拷贝赋值、移动构造、移动赋值（二） (fengyuanblog.github.io)](https://fengyuanblog.github.io/2017/06/20/C++构造-析构-拷贝构造-拷贝赋值-移动构造-移动赋值-二/)
4. [C++构造、析构、拷贝构造、拷贝赋值、移动构造、移动赋值（三） (fengyuanblog.github.io)](https://fengyuanblog.github.io/2017/06/20/C++构造-析构-拷贝构造-拷贝赋值-移动构造-移动赋值-三/)
5. [拷贝构造函数和移动构造函数](https://www.cnblogs.com/hunter-w/p/13884186.html)

