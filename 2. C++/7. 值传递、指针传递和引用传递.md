# 值传递、指针传递和引用传递
## 目录 or TODO
- [x] 1.值传递
- [x] 2.指针传递
- [x] 3.引用传递
- [x] 4.传递效率
- [x] 5.执行效率
- [x] 6.类型安全和参数检查
- [x] 7.参考资料
## 正文

### 1. 值传递

```c++
int FunA(string strTest){
    ...
}
string b = "abc";
FunA(b);
```

- 在`FunA`中用的`strTest`实际上是 `b`的一个**副本**（局部变量），对`strTest`的修改并**不影响** `b`的值；
- 当拷贝一个复杂的结构体或者类对象时，会造成无谓的资源浪费。

C语言只支持值传递

### 2. 指针传递

```c++
int FunA(string* strTest){
    ...
}
string b = "abc";
FunA(&b);
```

指针传递参数**本质上是值传递**，它所传递的是一个地址值，栈中开辟空间存放实参的值，从而**形参成为实参的一个副本**。strTest 指向的地址改变，其对应的实参指向的地址不会改变。

### 3. 引用传递

```c++
int FunA(string& strTest){
    ...
}
string b = "abc";
FunA(b);
```

形参作为局部变量也在栈开辟了空间，但是**存放的是实参变量的地址**。

- 在`FunA`中用的`strTest`和 `b`的一个指向的是同一块地址，同一个对象；
- 指针地址的复制成本可以接受；
-  C++ 规定引用不能为空，所以在函数中传进来引用可以直接使用；

**引用的规则** 

- 引用被创建的同时必须被初始化，指针则可以在任何时候被初始化
- 不能有 NULL 引用，引用必须与合法的存储单元关联，指针则可以是 NULL
- 一旦引用被初始化，就不能改变引用的关系，指针则可以随时改变所指的对象

### 4. 传递效率

**值传递和指针传递**

对于内建的 `int`, `char`, `short`, `long`, `float`等 4 字节及以下的数据类型而言，实际上传递时也只需要传递 1－4 个字节，而使用指针传递时在 32 位 cpu 中传递的是 32 位的指针，都是一条指令，值传递和指针传递的效率是一样的，而传递`double long`, `long long`等 8 字节的数据时，在 32 位 CPU 中，其传值效率比传递指针要慢，因为 8 个字节需要 2 次取完。而在 64 位的 CPU 上，传值和传址的效率是一样的。

当传递的对象是自定义的类或者结构体时，显然指针传递的效率高得多。

**引用传递**

需要看编译器的具体实现，引用传递最显然的实现方式是使用指针，这种情况下与指针的效率是一样的，而有些情况下编译器是可以优化成采用直接寻址的方式，这种情况下，效率比传值调用和指针传递都要快。

对于自定义的类或结构体，编译器不优化的情况，引用传递和指针传递的效率一样，优化了话引用传递效率更高。

### 5. 执行效率

**值传递**

当值被传到函数体内，临时对象生成以后，所有的执行任务都是通过**直接寻址**的方式执行的。

**指针传递和引用传递**

指针和大多数情况下的引用则是以**间接寻址**的方式执行的，所以实际的执行效率会比值传递要低。

**综合考虑，在 C++ 中进行参数传递时优先使用引用传递。**

### 6. 类型安全和参数检查

#### 6.1. 类型安全

**值传递**与**引用传递**在参数传递过程中都执行强类型检查，而**指针传递**的类型检查较弱，特别地，如果参数被声明为 	`void` ，那么它基本上没有类型检查，只要是指针，编译器就认为是合法的。

#### 6.2. 参数检查

不可能传一个不存在的值给值参数或引用参数，而使用指针可能传递一个非法的地址。

**最简单的一个原则就是看传递的是不是内建的数据类型，对内建的数据类型优先使用值传递，而对于自定义的数据类型，特别是传递较大的对象，那么请使用引用传递。**

### 7. 参考资料

1. [C++ 中的值传递和引用传递_liitdar的博客-CSDN博客](https://blog.csdn.net/liitdar/article/details/85982561)
2. [C++ 值传递和引用传递深入探究 | 猴开发 | 博客 (houkaifa.com)](https://houkaifa.com/2018/11/08/C-ConveyMode/)

