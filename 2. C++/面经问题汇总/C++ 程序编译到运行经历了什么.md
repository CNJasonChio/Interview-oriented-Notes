# C++ 程序编译到运行经历了什么
## 目录 or TODO
- [x] 1.预处理
- [x] 2.编译
- [x] 3.优化
- [x] 4.汇编
- [x] 5.链接
- [x] 6.参考链接
## 正文

### 1. 预处理

处理预编处理宏定义、条件编译指令、条件包含指令、特殊符号。综合来说实际上就是一个替换的动作,处理带 # 符号的命令和一些特殊符号.

`gcc -E hello.cpp hw.i`

### 2. 编译

词法分析、语法分析。在确定所有的指令都符合语法规则后，将其翻译成目标代码。
在编译的过程中，所有的变量都是虚拟地址，在汇编文件中有一个表，存储了虚拟地址对应的变量名称.
`g++ -S hello.i -o hello.s`

### 3. 优化

不仅同编译技术本身有关，而且同机器的硬件环境也有很大的关系。

优化一部分是对中间代码的优化。这种优化不依赖于具体的计算机。另一种优化则主要针对目标代码的生成而进行的。

对于前一种优化，主要的工作是删除公共表达式、循环优化（代码外提、强度削弱、变换循环控制条件、已知量的合并等）、复写传播，以及无用赋值的删除，等等。

后一种类型的优化同机器的硬件结构密切相关，最主要的是考虑是如何充分利用机器的各个硬件寄存器存放的有关变量的值，以减少对于内存的访问次数。另外，如何根据机器硬件执行指令的特点（如流水线、RISC、CISC、VLIW等）而对指令进行一些调整使目标代码比较短，执行的效率比较高，也是一个重要的研究课题。

经过优化得到的汇编代码必须经过汇编程序的汇编转换成相应的机器指令，方可能被机器执行。

### 4. 汇编

经历汇编过程编译转换成机器码,，最终形成与源程序等效的机器码。目标文件由段组成。通常一个目标文件至少有两个段  代码段 和 数据段。代码段包含了可读可执行的程序的指令。数据段保存各种全局变量和静态的数据。一般数据段可读可写可执行

`gcc -c hello.c -o hello.o` 这里的 hello.o 就是最后的机器码. 作为一个静态库的话可以说已经完成了, 不需要后面的流程。

### 5. 链接

目标文件并不能立即就被执行，其中可能还有许多没有解决的问题。例如：

- 某个源文件中的函数可能引用了另一个源文件中定义的某个符号（如变量或者函数调用等）；
- 在程序中可能调用了某个库文件中的函数。

链接程序的主要工作就是将有关的目标文件彼此相连接，也即将在一个文件中引用的符号同该符号在另外一个文件中的定义连接起来，使得所有的这些目标文件成为一个能够被操作系统装入执行的统一整体。

根据开发人员指定的同库函数的链接方式的不同，链接处理可分为两种：

**静态链接**

静态链接将链接库的代码复制到可执行程序中，使得可执行程序体积变大
**动态链接**

动态链接指的是需要链接的代码放到一个共享对象中，共享对象映射到进程虚地址空间，链接程序记录可执行程序将来需要用的代码信息，根据这些信息迅速定位相应的代码片段。

### 6. 参考链接

1. [c/c++ 从编译到执行_zt_xiaozhi-CSDN博客](https://blog.csdn.net/u010009169/article/details/72231774)

