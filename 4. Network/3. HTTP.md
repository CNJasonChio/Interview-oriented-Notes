# HTTP

## HTTP的基本知识

### HTTP是什么

HyperText Transfer Protocol，**超文本** **传输** **协议**，属于应用层协议。

HTTP 是一个在计算机世界⾥专门在「两点」之间「传输」⽂字、图片、⾳频、视频等「超文本」数据的「约定和规范」

- 超文本：文字、图片、视频、超链接等；
- 两点之间：可以是服务器和本地浏览器之间，可以是服务器之间，所以**两点之间**描述更准确；

### 常见状态码

<img src="http://image.961110.xyz/images/2021/07/08/HTTP.png" alt="五类HTTP状态码" style="zoom:50%;" />

#### 1xx

提示信息，表示目前是协议处理中的中间状态，实际用到的比较少；

#### 2xx

**成功**

1. 200 OK：一切正常。如果是非 HEAD 请求，服务器返回的响应头都会有 body 数据；
2. 204 No Content：除响应头没有 body 数据外，和 200 OK 相同；
3. 206 Partial Content：HTTP分块下载或者断点续传，表示响应返回的 body 数据是全部资源的一部分；

#### 3xx

**重定向**

1. 301 Moved Permanently：表示**永久重定向**，说明请求的资源已经不存在了，需改用新的 URL 再次访问。
2. 302 Found：表示临时重定向，说明请求的资源还在，但暂时需要用另一个 URL 来访问。 301 和 302 都会在响应头⾥使用字段 Location ，指明后续要跳转的 URL，浏览器会⾃动重定向新的 URL。
3. 304 Not Modified：不具有跳转的含义，表示资源未修改，重定向已存在的缓冲⽂件，也称缓存重定向，用于缓存控制。

#### 4xx

**客户端报文有误**

1. 400 Bad Request：表示客户端请求的报⽂有错误，但只是个笼统的错误；
2. 403 Forbidden：表示服务器禁⽌访问资源，并不是客户端的请求出错。
3. 404 Not Found：表示请求的资源在服务器上不存在或未找到，所以无法提供给客户端。

#### 5xx

**服务器内部错误**。

1. 500 Internal Server Error：是个笼统通用的错误码
2. 501 Not Implemented：客户端请求的功能还不支持；
3. 502 Bad Gateway：通常是服务器作为网关或代理时返回的错误码，表示服务器⾃身⼯作正常，访问后端服务器发⽣了错误。
4. 503 Service Unavailable：服务器正忙，无法响应。

### HTTP常见字段

##### Host字段

客户端在请求中指定服务器的域名，有了域名就可以访问同一台服务器上的不同网站；

##### Content-Length 字段

服务器在返回数据时声明本次回应的数据长度

##### Connection字段

最长用于客户端要求与服务端使用TCP持久连接，以便复用请求。

HTTP/1.1默认持久连接，但是为了兼容，所以需要指定`Connection`⾸部字段的值为 `Keep-Alive` 

##### Content-Type 字段

服务器回应时告诉客户端本次数据的格式。`Content-Type: text/html; charset=utf-8`

客户端可以在请求的时候声明可以接收的数据格式，`Accept: */*`表示任何格式，不挑。

##### Content-Encoding 字段

表示服务器返回的数据使用了什么压缩格式，同样，客户端在请求的时候也可以说明自己接受哪些压缩方法`Accept-Encoding: gzip, deflate`

### GET和POST

**GET** 从服务器获取资源；

**POST** 向 `URI`指定的资源提交数据（修改或者新增）；

##### 安全和幂等

在HTTP协议中，**安全**指的是不会破坏服务器上的资源；

**幂等**，执行多次**相同的操作**，**结果相同**。

显而易见，**GET是安全的且幂等的，POST是不安全且不幂等的。**

### HTTP特性

#### HTTP(1.1)优点

简单、灵活和易于拓展、应用广泛和跨平台

简单：报文格式：header+body，而且header的格式也是key-value，简单易于理解；

灵活和易于拓展：HTTP协议⾥的各类请求方法、URI/URL、状态码、头字段等每个组成要求都没有被固定死，都允许开发⼈员⾃定义和扩充。

应用广泛和跨平台：台式机浏览器、手机APP、新闻、购物、理财等等应用

#### 缺点

##### 无状态

服务器无需记忆浏览器的状态，可以减轻负担，但是在完成有关联性操作的时候麻烦，比如购物：登录-添加购物-下单-结算-支付，都需要用户身份。可以通过 **Cookie** 技术解决。

通过在请求和响应报文中写入 cookie 信息来控制客户端的状态。

##### 明文传输

方便阅读，调试。

裸奔。

##### 不安全

- 明文：内容被窃听；
- 不验证通讯方的身份：伪装
- 无法证明报文完整性：篡改

HTTPS引入了SSL/TLS层，解决了安全问题。

#### HTTP/1.1的性能如何

##### 长连接

HTTP/1.0每发起一个请求都需要建立一次TCP连接，而 1.1 增加了长连接的通信方式，降低了无谓的开销。

##### 管道网络传输

在同一个TCP连接中，客户端**可以发起多个请求**，不必等上一个请求的响应。

但是服务器响应还是按照请求顺序进行，当先到的请求处理缓慢，就会导致后面的请求处理不过来，也叫**队头阻塞**。

### HTTP和HTTPS

#### 区别

1. HTTP是明文传输，没有身份认证，HTTPS加入了SSL/TLS安全协议：
   - 报文加密传输
   - 有内容校验机制，无法篡改。
   - 需要向CA（证书权威机构）申请数字证书，解决了身份无法验证的问题。
2. HTTP在建立了TCP连接之后就可以传输报文，而HTTPS还需要进行SSL/TLS的握手；
3. HTTP端口号是 80， HTTPS是 443。

#### HTTPS如何解决窃听、篡改、冒充的问题

- **混合加密**：实现信息的机密性，解决了窃听的风险；
- **摘要算法**：来实现**完整性**，它能够为数据生成第一无二的「指纹」，指纹用于校验数据的完整性 
- 将服务器公钥放入到**数字证书**中，解决了冒充的风险。

##### 混合加密

在**通信建立前**采用 **非对称加密**的方式交换 **会话秘钥**，后续不再使用非对称加密；
在**通信过程中**，全部使用 **对称加密** 的 **会话密钥** 的方式加密明文数据。

采用「混合加密」的方式的原因：
**对称加密**只使用**一个**密钥，运算**速度快**，密钥必须保密，无法做到安全的密钥交换。 
**非对称加密**使用**两个**密钥：公钥和私钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但**速度慢**。

##### 摘要算法

客户端的把数据的指纹和明文一同加密成密文后，发送给服务器，服务器解密后使用相同的摘要算法计算明文的指纹，和客户端的作比较。

##### 数字证书

客户端向服务器端索要公钥，然后用公钥加密信息，服务器收到密文后用自己的私钥解密。

第三方权威机构CA（数字证书认证机构）将服务器公钥放在数字证书（CA用自己的私钥签名）中，只要证书可信（客户端用CA的公钥来确认），公钥就可信，保证了公钥不被篡改
